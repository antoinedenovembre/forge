#!/usr/bin/env bash

VERSION="0.2.0"
FORGE_CONFIG="forge.json"

# Get script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
export LIB_DIR="$SCRIPT_DIR/lib"

# Source logging functions
source "$LIB_DIR/log.sh"

# Check dependencies
check_deps() {
    command -v jq >/dev/null 2>&1 || error "jq is required. Install it with: apt install jq / brew install jq"
    command -v git >/dev/null 2>&1 || error "git is required"
}

case "$1" in
    init)
        shift
        source "$LIB_DIR/forge-init.sh"
        forge_init "$@"
        ;;
    install)
        shift
        source "$LIB_DIR/forge-install.sh"
        forge_install "$@"
        ;;
    build)
        shift
        source "$LIB_DIR/forge-build.sh"
        forge_build "$@"
        ;;
    run)
        shift
        source "$LIB_DIR/forge-run.sh"
        forge_run "$@"
        ;;
    test)
        shift
        source "$LIB_DIR/forge-test.sh"
        forge_test "$@"
        ;;
    clean)
        shift
        source "$LIB_DIR/forge-clean.sh"
        forge_clean "$@"
        ;;
    --version|-v)
        echo "forge version $VERSION"
        ;;
    --help|-h|"")
        cat << EOF
Forge - A C++ project manager

Usage: forge <command> [options]

Commands:
    init [name]       Initialize a new C++ project
    install [dep]     Install dependencies
    build             Build the project
    run               Build and run the project
    clean             Clean build artifacts
    test              Run unit tests

Options:
    -h, --help        Show this help
    -v, --version     Show version

EOF
        ;;
    *)
        error "Unknown command: $1. Use 'forge --help' for usage."
        ;;
esac